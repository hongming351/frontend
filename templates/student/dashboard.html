<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能OJ系统学生端 - 学生答题平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        success: '#52C41A',
                        warning: '#FAAD14',
                        danger: '#FF4D4F',
                        dark: '#1D2129',
                        'dark-2': '#4E5969',
                        'light-1': '#F2F3F5',
                        'light-2': '#E5E6EB',
                        'light-3': '#C9CDD4'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .editor-line {
                @apply border-l-2 border-transparent pl-3 py-1 hover:border-primary/30 transition-colors;
            }
            .editor-line.active {
                @apply border-primary bg-primary/5;
            }
            .nav-item {
                @apply flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 hover:bg-primary/10 text-dark-2;
            }
            .nav-item.active {
                @apply bg-primary/10 text-primary font-medium;
            }
            .card {
                @apply bg-white rounded-xl shadow-sm border border-light-2 overflow-hidden transition-shadow hover:shadow-md;
            }
            .btn {
                @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2;
            }
            .btn-primary {
                @apply bg-primary text-white hover:bg-primary/90 active:bg-primary/80;
            }
            .btn-outline {
                @apply border border-light-3 hover:border-primary hover:text-primary;
            }
        }
    </style>
</head>
<body class="font-inter bg-light-1 text-dark min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white border-b border-light-2 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <button id="sidebar-toggle" class="lg:hidden p-2 rounded-md hover:bg-light-1" onclick="toggleSidebar()">
                    <i class="fa fa-bars text-dark-2"></i>
                </button>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white">
                        <i class="fa fa-code"></i>
                    </div>
                    <h1 class="text-xl font-semibold text-dark hidden sm:block">智能OJ系统-学生端</h1>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="relative hidden md:block">
                    <input type="text" placeholder="搜索题目..." class="pl-10 pr-4 py-2 rounded-lg border border-light-2 focus:outline-none focus:border-primary w-64 text-sm">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-light-3"></i>
                </div>
                
                <button class="p-2 rounded-full hover:bg-light-1 relative">
                    <i class="fa fa-bell-o text-dark-2"></i>
                    <span class="absolute top-1 right-1 w-2 h-2 bg-danger rounded-full"></span>
                </button>
                
                <div class="flex items-center gap-2 group">
                    <img src="https://picsum.photos/id/64/40/40" alt="用户头像" class="w-8 h-8 rounded-full object-cover border border-light-2">
                    <span class="text-sm font-medium hidden sm:block">{{ user.username }}</span>
                    <i class="fa fa-angle-down text-light-3 text-xs transition-transform group-hover:rotate-180"></i>
                    
                    <!-- 用户菜单 -->
                    <div class="absolute right-4 mt-14 w-48 bg-white rounded-lg shadow-lg border border-light-2 py-2 hidden group-hover:block z-50">
                        <a href="#" class="block px-4 py-2 text-sm hover:bg-light-1 transition-colors" onclick="navigateTo('profile')">
                            <i class="fa fa-user-o mr-2 text-light-3"></i>个人资料
                        </a>
                        <a href="#" class="block px-4 py-2 text-sm hover:bg-light-1 transition-colors" onclick="navigateTo('password-reset-self')">
                            <i class="fa fa-key mr-2 text-light-3"></i>修改密码
                        </a>
                        <div class="border-t border-light-2 my-1"></div>
                        <a href="/logout" class="block px-4 py-2 text-sm text-danger hover:bg-light-1 transition-colors">
                            <i class="fa fa-sign-out mr-2"></i>退出登录
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- 侧边栏 -->
        <aside id="sidebar" class="w-64 bg-white border-r border-light-2 flex-shrink-0 hidden lg:block transition-all duration-300 ease-in-out transform z-40">
            <div class="h-full flex flex-col">
                <nav class="p-3 flex-1 overflow-y-auto">
                    <div class="space-y-1">
                        <p class="px-4 text-xs font-medium text-light-3 uppercase tracking-wider mb-2">主菜单</p>
                        <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                            <i class="fa fa-tachometer w-5 text-center"></i>
                            <span>仪表盘</span>
                        </a>
                        <a href="#course" class="nav-item" onclick="showSection('course')">
                            <i class="fa fa-book w-5 text-center"></i>
                            <span>课程学习</span>
                        </a>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="flex-1 overflow-y-auto p-4 md:p-6">
            <div class="max-w-7xl mx-auto space-y-6">
                <!-- 1. 仪表盘模块 -->
                <section id="dashboard">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold">仪表盘</h2>
                            <p class="text-dark-2 mt-1">学习数据概览与进度追踪</p>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <button class="btn btn-outline">
                                <i class="fa fa-download"></i>
                                <span>导出报告</span>
                            </button>
                            <button class="btn btn-primary">
                                <i class="fa fa-plus"></i>
                                <span>开始练习</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 数据卡片 -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="card p-5">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-dark-2 text-sm">已完成题目</p>
                                    <h3 class="text-2xl font-semibold mt-1">42</h3>
                                    <p class="text-success text-xs mt-2"><i class="fa fa-arrow-up"></i> 较上周增长 12%</p>
                                </div>
                                <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                                    <i class="fa fa-check"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-5">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-dark-2 text-sm">参与竞赛</p>
                                    <h3 class="text-2xl font-semibold mt-1">5</h3>
                                    <p class="text-success text-xs mt-2"><i class="fa fa-arrow-up"></i> 较上月增长 2 场</p>
                                </div>
                                <div class="w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center text-warning">
                                    <i class="fa fa-trophy"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-5">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-dark-2 text-sm">掌握知识点</p>
                                    <h3 class="text-2xl font-semibold mt-1">13/20</h3>
                                    <p class="text-dark-2 text-xs mt-2">完成度 65%</p>
                                </div>
                                <div class="w-10 h-10 rounded-lg bg-success/10 flex items-center justify-center text-success">
                                    <i class="fa fa-book"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-5">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-dark-2 text-sm">连续练习</p>
                                    <h3 class="text-2xl font-semibold mt-1">7 天</h3>
                                    <p class="text-dark-2 text-xs mt-2">距离下一个徽章还差 3 天</p>
                                </div>
                                <div class="w-10 h-10 rounded-lg bg-secondary/10 flex items-center justify-center text-secondary">
                                    <i class="fa fa-fire"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 学习趋势图表 -->
                    <div class="card p-6">
                        <h3 class="font-semibold mb-4">每周练习趋势</h3>
                        <div class="h-64">
                            <canvas id="practice-chart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- 2. 课程学习模块 -->
                <section id="course" class="hidden">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold">课程学习</h2>
                            <p class="text-dark-2 mt-1">按课程体系循序渐进学习</p>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <div class="relative">
                                <input type="text" placeholder="搜索课程..." class="pl-10 pr-4 py-2 rounded-lg border border-light-2 focus:outline-none focus:border-primary w-full md:w-64 text-sm">
                                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-light-3"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 课程列表 -->
                    <div id="courses-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 课程卡片将由JavaScript动态加载 -->
                        <div id="no-courses-message" class="hidden col-span-full text-center py-12">
                            <div class="w-16 h-16 bg-light-1 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fa fa-book text-2xl text-light-3"></i>
                            </div>
                            <h3 class="text-lg font-medium text-dark-2 mb-2">暂无课程</h3>
                            <p class="text-dark-2">您尚未加入任何课程，请联系老师添加课程。</p>
                        </div>
                    </div>
                </section>




                <!-- 6. 两数之和题目模块 -->
                <section id="problem-1" class="hidden">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold">题目练习</h2>
                            <p class="text-dark-2 mt-1">完成下面的编程题目并提交</p>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <button class="btn btn-outline">
                                <i class="fa fa-history"></i>
                                <span>历史记录</span>
                            </button>
                            <button class="btn btn-outline">
                                <i class="fa fa-star-o"></i>
                                <span>收藏</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 题目卡片 -->
                    <div class="card p-6">
                        <div class="flex flex-col md:flex-row md:items-start gap-4 mb-4">
                            <h3 class="text-xl font-semibold">两数之和</h3>
                            <span class="inline-flex items-center gap-1 text-xs px-3 py-1 bg-primary/10 text-primary rounded-full self-start">
                                <i class="fa fa-signal"></i>简单
                            </span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium text-dark-2 mb-2">题目描述</h4>
                                <p class="text-dark leading-relaxed">
                                    给定一个整数数组 nums 和一个整数目标值 target，请你在该数组中找出和为目标值 target 的那两个整数，并返回它们的数组下标。
                                    你可以假设每种输入只会对应一个答案。但是，数组中同一个元素在答案里不能重复出现。
                                    你可以按任意顺序返回答案。
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-medium text-dark-2 mb-2">示例</h4>
                                <div class="bg-light-1 rounded-lg p-4 font-mono text-sm">
                                    <p>输入：nums = [2,7,11,15], target = 9</p>
                                    <p>输出：[0,1]</p>
                                    <p class="mt-2">解释：因为 nums[0] + nums[1] == 9 ，返回 [0, 1] 。</p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium text-dark-2 mb-2">提示</h4>
                                <ul class="list-disc pl-5 text-dark space-y-1">
                                    <li>2 <= nums.length <= 10^4</li>
                                    <li>-10^9 <= nums[i] <= 10^9</li>
                                    <li>-10^9 <= target <= 10^9</li>
                                    <li>只会存在一个有效答案</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 代码编辑和提交区域 -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- 代码编辑器 -->
                        <div class="lg:col-span-2 space-y-4">
                            <div class="card">
                                <div class="border-b border-light-2 px-6 py-3 flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded">Python</span>
                                            <button class="text-dark-2 hover:text-primary">
                                                <i class="fa fa-cog"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="hidden md:flex items-center gap-1 text-sm text-dark-2">
                                            <span class="px-2 py-1 hover:bg-light-1 rounded">文件</span>
                                            <span class="px-2 py-1 hover:bg-light-1 rounded">编辑</span>
                                            <span class="px-2 py-1 hover:bg-light-1 rounded">查看</span>
                                            <span class="px-2 py-1 hover:bg-light-1 rounded">帮助</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center gap-2">
                                        <button class="p-1.5 text-dark-2 hover:text-primary hover:bg-light-1 rounded">
                                            <i class="fa fa-copy"></i>
                                        </button>
                                        <button class="p-1.5 text-dark-2 hover:text-primary hover:bg-light-1 rounded">
                                            <i class="fa fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="p-4 font-mono text-sm bg-light-1">
                                    <div class="flex">
                                        <!-- 行号 -->
                                        <div class="text-right pr-4 text-light-3 select-none">
                                            <div class="py-1">1</div>
                                            <div class="py-1">2</div>
                                            <div class="py-1">3</div>
                                            <div class="py-1">4</div>
                                            <div class="py-1">5</div>
                                            <div class="py-1">6</div>
                                            <div class="py-1">7</div>
                                            <div class="py-1">8</div>
                                        </div>
                                        
                                        <!-- 代码内容 -->
                                        <div class="flex-1 min-w-0">
                                            <div class="editor-line">class Solution:</div>
                                            <div class="editor-line">    def twoSum(self, nums: List[int], target: int) -> List[int]:</div>
                                            <div class="editor-line active">        hashmap = {}</div>
                                            <div class="editor-line">        for i, num in enumerate(nums):</div>
                                            <div class="editor-line">            complement = target - num</div>
                                            <div class="editor-line">            if complement in hashmap:</div>
                                            <div class="editor-line">                return [hashmap[complement], i]</div>
                                            <div class="editor-line">            hashmap[num] = i</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border-t border-light-2 p-4 flex items-center justify-between">
                                    <div class="flex items-center gap-2 text-sm text-dark-2">
                                        <span><i class="fa fa-info-circle"></i> 已自动保存</span>
                                    </div>
                                    
                                    <button id="submit-code" class="btn btn-primary">
                                        <i class="fa fa-paper-plane"></i>
                                        <span>提交代码</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 测试用例 -->
                            <div class="card">
                                <div class="border-b border-light-2 px-6 py-3">
                                    <h4 class="font-medium">测试用例</h4>
                                </div>
                                
                                <div class="p-4">
                                    <div class="flex gap-2 mb-3">
                                    <button class="btn btn-outline text-sm px-3 py-1.5">
                                        <i class="fa fa-plus"></i> 添加测试用例
                                    </button>
                                    <button id="run-test-btn" class="btn btn-outline text-sm px-3 py-1.5">
                                        <i class="fa fa-play"></i> 运行测试
                                    </button>
                                </div>

                                <script>
                                    // 页面加载完成后执行
                                    document.addEventListener('DOMContentLoaded', function() {
                                        // 运行测试按钮事件
                                        document.getElementById('run-test-btn')?.addEventListener('click', async function() {
                                            // 显示测试中状态
                                            const testResultContainer = document.createElement('div');
                                            testResultContainer.className = 'mt-3 p-3 bg-light-1 rounded-lg';
                                            testResultContainer.innerHTML = `
                                                <div class="flex items-center justify-center mb-2">
                                                    <i class="fa fa-spinner fa-spin text-dark-2 mr-2"></i>
                                                    <span class="text-sm font-medium">测试运行中...</span>
                                                </div>
                                            `;

                                            // 找到测试用例容器并添加结果
                                            const testCaseContainer = document.querySelector('#test-cases .space-y-3');
                                            if (testCaseContainer) {
                                                testCaseContainer.appendChild(testResultContainer);
                                            }

                                            try {
                                                // 获取代码和测试用例
                                                const code = '// 示例代码\n' + document.getElementById('code-editor')?.value || 'print("Hello World")';
                                                const problemId = 1; // 实际应用中应从页面动态获取
                                                const language = 'python'; // 实际应用中可从下拉菜单获取

                                                // 获取第一个测试用例（实际应用中可能需要选择特定测试用例）
                                                const testCaseElement = document.querySelector('#test-cases .border');
                                                if (!testCaseElement) {
                                                    throw new Error('没有找到测试用例');
                                                }

                                                const inputElement = testCaseElement.querySelector('.font-mono');
                                                const input = inputElement ? inputElement.textContent.trim() : '';

                                                const expectedOutputElement = testCaseElement.querySelectorAll('.font-mono')[1];
                                                const expectedOutput = expectedOutputElement ? expectedOutputElement.textContent.trim() : '';

                                                const testCase = {
                                                    input: input,
                                                    expected_output: expectedOutput
                                                };

                                                // 调用API运行测试用例
                                                const response = await fetch('/api/test-case/run', {
                                                    method: 'POST',
                                                    headers: { 'Content-Type': 'application/json' },
                                                    body: JSON.stringify({ problemId, code, language, testCase })
                                                });

                                                const result = await response.json();

                                                if (result.success) {
                                                    // 更新测试结果显示
                                                    testResultContainer.innerHTML = `
                                                        <div class="flex items-center ${result.passed ? 'text-success' : 'text-danger'} mb-2">
                                                            <i class="fa ${result.passed ? 'fa-check-circle' : 'fa-times-circle'} mr-2"></i>
                                                            <span class="text-sm font-medium">${result.passed ? '测试通过' : '测试失败'}</span>
                                                        </div>
                                                        <div class="space-y-2 text-sm">
                                                            <div>
                                                                <p class="text-dark-2 mb-1">输入:</p>
                                                                <div class="bg-dark/5 p-2 rounded font-mono whitespace-pre-wrap">${testCase.input}</div>
                                                            </div>
                                                            <div>
                                                                <p class="text-dark-2 mb-1">预期输出:</p>
                                                                <div class="bg-dark/5 p-2 rounded font-mono whitespace-pre-wrap">${testCase.expected_output}</div>
                                                            </div>
                                                            <div>
                                                                <p class="text-dark-2 mb-1">实际输出:</p>
                                                                <div class="bg-dark/5 p-2 rounded font-mono whitespace-pre-wrap">${result.output}</div>
                                                            </div>
                                                            <div class="flex justify-between mt-1">
                                                                <span class="text-dark-2">执行时间:</span>
                                                                <span>${result.execution_time} ms</span>
                                                            </div>
                                                        </div>
                                                    `;
                                                } else {
                                                    testResultContainer.innerHTML = `
                                                        <div class="flex items-center text-danger mb-2">
                                                            <i class="fa fa-times-circle mr-2"></i>
                                                            <span class="text-sm font-medium">测试失败</span>
                                                        </div>
                                                        <p class="text-sm text-dark-2">${result.message || '测试运行失败'}</p>
                                                    `;
                                                }
                                            } catch (error) {
                                                console.error('运行测试失败:', error);
                                                if (testResultContainer) {
                                                    testResultContainer.innerHTML = `
                                                        <div class="flex items-center text-danger mb-2">
                                                            <i class="fa fa-times-circle mr-2"></i>
                                                            <span class="text-sm font-medium">测试失败</span>
                                                        </div>
                                                        <p class="text-sm text-dark-2">${error.message || '网络错误，请重试'}</p>
                                                    `;
                                                }
                                            }
                                        });
                                    });
                                </script>
                                    
                                    <div class="space-y-3">
                                        <div class="border border-light-2 rounded-lg overflow-hidden">
                                            <div class="bg-light-1 px-3 py-2 flex items-center justify-between text-sm">
                                                <span>测试用例 1</span>
                                                <div class="flex gap-1">
                                                    <button class="p-1 text-dark-2 hover:text-primary"><i class="fa fa-edit"></i></button>
                                                    <button class="p-1 text-dark-2 hover:text-danger"><i class="fa fa-trash-o"></i></button>
                                                </div>
                                            </div>
                                            <div class="p-3">
                                                <div class="mb-2">
                                                    <p class="text-xs text-dark-2 mb-1">输入</p>
                                                    <div class="bg-light-1 rounded p-2 text-sm font-mono">nums = [2,7,11,15], target = 9</div>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-dark-2 mb-1">预期输出</p>
                                                    <div class="bg-light-1 rounded p-2 text-sm font-mono">[0, 1]</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 提交结果和统计 -->
                        <div class="space-y-6">
                            <!-- 提交结果 -->
                            <div class="card">
                                <div class="border-b border-light-2 px-6 py-3">
                                    <h4 class="font-medium">提交结果</h4>
                                </div>
                                
                                <div id="result-container" class="p-4 text-center py-8">
                                    <div class="w-16 h-16 bg-light-1 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <i class="fa fa-clock-o text-2xl text-light-3"></i>
                                    </div>
                                    <p class="text-dark-2">尚未提交代码</p>
                                    <p class="text-xs text-light-3 mt-1">提交后将显示结果</p>
                                </div>
                            </div>
                            
                            <!-- 答题统计 -->
                            <div class="card">
                                <div class="border-b border-light-2 px-6 py-3">
                                    <h4 class="font-medium">答题统计</h4>
                                </div>
                                
                                <div class="p-4">
                                    <div class="mb-4">
                                        <canvas id="submission-chart" height="180"></canvas>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="w-3 h-3 rounded-full bg-success"></span>
                                                <span class="text-sm">通过</span>
                                            </div>
                                            <span class="text-sm font-medium">12 次</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="w-3 h-3 rounded-full bg-danger"></span>
                                                <span class="text-sm">未通过</span>
                                            </div>
                                            <span class="text-sm font-medium">8 次</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="w-3 h-3 rounded-full bg-warning"></span>
                                                <span class="text-sm">超时</span>
                                            </div>
                                            <span class="text-sm font-medium">3 次</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 相关知识点 -->
                            <div class="card">
                                <div class="border-b border-light-2 px-6 py-3">
                                    <h4 class="font-medium">相关知识点</h4>
                                </div>
                                
                                <div class="p-4">
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-3 py-1 bg-light-1 text-dark-2 text-xs rounded-full hover:bg-primary/10 hover:text-primary cursor-pointer transition-colors">哈希表</span>
                                        <span class="px-3 py-1 bg-light-1 text-dark-2 text-xs rounded-full hover:bg-primary/10 hover:text-primary cursor-pointer transition-colors">数组</span>
                                        <span class="px-3 py-1 bg-light-1 text-dark-2 text-xs rounded-full hover:bg-primary/10 hover:text-primary cursor-pointer transition-colors">双指针</span>
                                        <span class="px-3 py-1 bg-light-1 text-dark-2 text-xs rounded-full hover:bg-primary/10 hover:text-primary cursor-pointer transition-colors">枚举</span>
                                    </div>
                                    
                                    <button class="mt-4 w-full py-2 border border-light-2 rounded-lg text-sm text-dark-2 hover:border-primary hover:text-primary transition-colors">
                                        查看解题思路
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 7. 三数之和题目模块（简化版） -->
                <section id="problem-2" class="hidden">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold">题目练习</h2>
                            <p class="text-dark-2 mt-1">完成下面的编程题目并提交</p>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <div class="flex flex-col md:flex-row md:items-start gap-4 mb-4">
                            <h3 class="text-xl font-semibold">三数之和</h3>
                            <span class="inline-flex items-center gap-1 text-xs px-3 py-1 bg-warning/10 text-warning rounded-full self-start">
                                <i class="fa fa-signal"></i>中等
                            </span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium text-dark-2 mb-2">题目描述</h4>
                                <p class="text-dark leading-relaxed">
                                    给你一个包含 n 个整数的数组 nums，判断 nums 中是否存在三个元素 a，b，c ，使得 a + b + c = 0 ？请你找出所有和为 0 且不重复的三元组。
                                    注意：答案中不可以包含重复的三元组。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 8. 最长有效括号题目模块（简化版） -->
                <section id="problem-3" class="hidden">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-semibold">题目练习</h2>
                            <p class="text-dark-2 mt-1">完成下面的编程题目并提交</p>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <div class="flex flex-col md:flex-row md:items-start gap-4 mb-4">
                            <h3 class="text-xl font-semibold">最长有效括号</h3>
                            <span class="inline-flex items-center gap-1 text-xs px-3 py-1 bg-danger/10 text-danger rounded-full self-start">
                                <i class="fa fa-signal"></i>困难
                            </span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium text-dark-2 mb-2">题目描述</h4>
                                <p class="text-dark leading-relaxed">
                                    给你一个只包含 '(' 和 ')' 的字符串，找出最长有效（格式正确且连续）括号子串的长度。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // 侧边栏切换（移动端）
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', async () => {
            // 检查URL锚点，如果是#course则显示课程学习，否则默认显示仪表盘
            const hash = window.location.hash;
            if (hash === '#course') {
                showSection('course');
            } else {
                showSection('dashboard');
            }
            
            try {
                // 获取学生统计信息
                const response = await fetch('/api/students/performance', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('获取数据失败');
                }
                
                const stats = await response.json();
                
                // 更新仪表盘数据
                if (stats.success && stats.data) {
                    document.querySelector('#completed-problems h3').textContent = stats.data.accepted_submissions;
                    document.querySelector('#contest-count h3').textContent = stats.data.total_contests;
                    document.querySelector('#knowledge-mastered h3').textContent = `${stats.data.solved_topics}/${stats.data.total_topics}`;
                    document.querySelector('#practice-days h3').textContent = stats.data.streak_days;
                    
                    // 更新图表数据
                    initCharts(stats.data);
                }
            } catch (error) {
                console.error('初始化数据失败:', error);
            }
        });

        // 显示指定模块，隐藏其他模块
        function showSection(sectionId) {
            // 隐藏所有模块
            const sections = document.querySelectorAll('main section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });

            // 显示目标模块
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                // 平滑滚动到顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // 更新导航激活状态
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
                // 给当前点击的导航项添加激活样式
                if (item.getAttribute('href') === `#${sectionId}`) {
                    item.classList.add('active');
                }
            });
        }

        // 初始化所有图表
        function initCharts() {
            // 仪表盘 - 每周练习趋势图
            const practiceCtx = document.getElementById('practice-chart');
            if (practiceCtx) {
                new Chart(practiceCtx, {
                    type: 'line',
                    data: {
                        labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                        datasets: [{
                            label: '完成题目数',
                            data: [3, 5, 2, 7, 4, 6, 8],
                            borderColor: '#165DFF',
                            backgroundColor: 'rgba(22, 93, 255, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // 学习统计 - 每日刷题量
            const dailyCtx = document.getElementById('daily-chart');
            if (dailyCtx) {
                new Chart(dailyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['8/12', '8/13', '8/14', '8/15', '8/16', '8/17', '8/18'],
                        datasets: [{
                            label: '刷题数量',
                            data: [3, 5, 2, 7, 4, 6, 3],
                            backgroundColor: '#165DFF'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // 学习统计 - 题目难度分布
            const difficultyCtx = document.getElementById('difficulty-chart');
            if (difficultyCtx) {
                new Chart(difficultyCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['简单', '中等', '困难'],
                        datasets: [{
                            data: [24, 15, 3],
                            backgroundColor: ['#52C41A', '#FAAD14', '#FF4D4F']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // 提交统计图表
            const submissionCtx = document.getElementById('submission-chart');
            if (submissionCtx) {
                new Chart(submissionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['通过', '未通过', '超时'],
                        datasets: [{
                            data: [12, 8, 3],
                            backgroundColor: ['#52C41A', '#FF4D4F', '#FAAD14']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        // 代码提交功能
        document.getElementById('submit-code')?.addEventListener('click', async function() {
            const resultContainer = document.getElementById('result-container');
            const codeLines = document.querySelectorAll('.editor-line');
            let code = '';
            codeLines.forEach(line => {
                const lineText = line.textContent;
                if (lineText.trim() && !lineText.includes('class Solution') && !lineText.includes('def twoSum')) {
                    code += lineText + '\n';
                }
            });
            const problemId = window.location.pathname.split('/').pop() || 1;
            
            resultContainer.innerHTML = `
                <div class="w-16 h-16 bg-light-1 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fa fa-spinner fa-spin text-2xl text-dark-2"></i>
                </div>
                <p class="text-dark font-medium">提交中...</p>
                <p class="text-sm text-dark-2 mt-1">正在评判您的代码</p>
            `;

            try {
                const response = await fetch('/api/submissions', {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        problem_id: problemId,
                        code: code,
                        language: 'python',
                        user_id: localStorage.getItem('user_id')
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultContainer.innerHTML = `
                            <div class="w-16 h-16 ${data.passed ? 'bg-success/10 text-success' : 'bg-danger/10 text-danger'} rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fa ${data.passed ? 'fa-check' : 'fa-times'} text-2xl"></i>
                            </div>
                            <p class="text-dark font-medium">${data.passed ? '提交成功' : '提交失败'}</p>
                            <p class="text-sm text-dark-2 mt-1">${data.message || ''}</p>
                            <div class="mt-4 pt-4 border-t border-light-2">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-dark-2">执行时间</span>
                                    <span>${data.execution_time || 0} ms</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-dark-2">内存消耗</span>
                                    <span>${data.memory_usage || 0} MB</span>
                                </div>
                            </div>
                            ${data.error ? `
                            <div class="mt-3 p-3 bg-danger/10 rounded-lg text-sm text-danger">
                                <p><i class="fa fa-exclamation-circle mr-1"></i> 错误信息:</p>
                                <p class="mt-1 font-mono whitespace-pre-wrap">${data.error}</p>
                            </div>
                            ` : ''}
                        `;
                } else {
                    throw new Error(data.message || '提交失败');
                }
            } catch (error) {
                resultContainer.innerHTML = `
                    <div class="w-16 h-16 bg-danger/10 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fa fa-times text-2xl text-danger"></i>
                    </div>
                    <p class="text-dark font-medium">提交失败</p>
                    <p class="text-sm text-dark-2 mt-1">${error.message}</p>
                `;
            }
        });

        // 用户菜单导航功能
        function navigateTo(page) {
            switch(page) {
                case 'profile':
                    window.location.href = '/student/profile';
                    break;
                case 'password-reset-self':
                    // 直接跳转到个人资料页面，修改密码功能在那里
                    window.location.href = '/student/profile';
                    break;
                default:
                    console.log('未知的导航目标:', page);
            }
        }

        // 加载学生课程
        async function loadStudentCourses() {
            try {
                // 直接获取学生课程（API会从session中获取学生信息）
                const coursesResponse = await fetch('/api/student/courses');
                if (!coursesResponse.ok) {
                    throw new Error('获取课程信息失败');
                }

                const coursesData = await coursesResponse.json();
                const coursesContainer = document.getElementById('courses-container');
                const noCoursesMessage = document.getElementById('no-courses-message');

                if (coursesData.success && coursesData.data && coursesData.data.length > 0) {
                    // 隐藏无课程消息
                    noCoursesMessage.classList.add('hidden');

                    // 清空现有课程卡片
                    coursesContainer.innerHTML = '';

                    // 添加课程卡片
                    coursesData.data.forEach(course => {
                        const courseCard = createCourseCard(course);
                        coursesContainer.appendChild(courseCard);
                    });
                } else {
                    // 显示无课程消息
                    noCoursesMessage.classList.remove('hidden');
                }
            } catch (error) {
                console.error('加载课程失败:', error);
                const coursesContainer = document.getElementById('courses-container');
                const noCoursesMessage = document.getElementById('no-courses-message');
                noCoursesMessage.classList.remove('hidden');
                noCoursesMessage.innerHTML = `
                    <div class="w-16 h-16 bg-light-1 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-exclamation-triangle text-2xl text-warning"></i>
                    </div>
                    <h3 class="text-lg font-medium text-dark-2 mb-2">加载课程失败</h3>
                    <p class="text-dark-2">${error.message || '请刷新页面重试'}</p>
                `;
            }
        }

        // 创建课程卡片
        function createCourseCard(course) {
            const isPython = course.name.includes('Python') || course.language === 'Python';
            const courseImage = isPython ? 'https://picsum.photos/id/0/600/400' : 'https://picsum.photos/id/1/600/400';
            const courseDescription = isPython
                ? '掌握Python基本语法、数据结构与常用算法，适合编程入门学习者。'
                : '学习C++面向对象编程、内存管理和高级特性，适合有一定编程基础的学习者。';

            const card = document.createElement('div');
            card.className = 'card cursor-pointer';
            card.onclick = () => {
                // 跳转到课程详情页面，包含班级ID参数
                const url = `/student/course?course_id=${course.id}&class_id=${course.class_id}`;
                window.location.href = url;
            };
            card.innerHTML = `
                <div class="h-40 bg-primary/5 relative">
                    <img src="${courseImage}" alt="${course.name}" class="w-full h-full object-cover">
                    <div class="absolute top-3 right-3 bg-primary text-white text-xs px-2 py-1 rounded">进行中</div>
                </div>
                <div class="p-5">
                    <h3 class="font-semibold">${course.name}</h3>
                    <p class="text-dark-2 text-sm mt-1 line-clamp-2">${courseDescription}</p>

                    <div class="mt-4">
                        <div class="flex justify-between text-xs mb-1">
                            <span>学习进度</span>
                            <span>75%</span>
                        </div>
                        <div class="w-full bg-light-1 rounded-full h-1.5">
                            <div class="bg-primary h-1.5 rounded-full" style="width: 75%"></div>
                        </div>
                    </div>

                    <button class="mt-4 w-full py-2 bg-primary/10 text-primary rounded-lg text-sm font-medium hover:bg-primary/20 transition-colors" onclick="event.stopPropagation(); window.location.href='/student/course?course_id=${course.id}&class_id=${course.class_id}'">
                        继续学习
                    </button>
                </div>
            `;
            return card;
        }

        // 当课程学习模块显示时加载课程
        document.addEventListener('DOMContentLoaded', function() {
            // 监听课程学习模块的显示
            const courseSection = document.getElementById('course');
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'class') {
                        if (!courseSection.classList.contains('hidden')) {
                            loadStudentCourses();
                        }
                    }
                });
            });
            
            observer.observe(courseSection, { attributes: true });
        });
    </script>
</body>
</html>
